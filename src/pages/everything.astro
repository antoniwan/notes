---
import PageLayout from '../layouts/PageLayout.astro';
import LazyPosts from '../components/LazyPosts.astro';
import ViewToggle from '../components/ViewToggle.astro';
import { getCollection } from 'astro:content';

// Get all published posts
const posts = await getCollection('blog', ({ data }) => {
  return import.meta.env.PROD ? !data.draft : true;
});

// Sort posts by date (newest first)
const sortedPosts = posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<PageLayout
  title="Everything (All Posts)"
  description="The full record, newest to oldest. Scroll away! ğŸ“"
  path="/everything"
  structuredDataType="website"
>
  {
    sortedPosts.length > 0 ? (
      <>
        <ViewToggle defaultView="grid" />
        <LazyPosts posts={sortedPosts} initialCount={12} loadMoreCount={12} />
      </>
    ) : (
      <div class="py-16 text-center md:py-20">
        <div class="mx-auto max-w-md space-y-3">
          <div class="mb-6 text-6xl">ğŸ“</div>
          <h2
            class="text-heading text-[rgb(var(--color-text))]"
            style="line-height: 1.3; margin: 0;"
          >
            No posts yet
          </h2>
          <p
            class="text-body-large leading-relaxed text-[rgb(var(--color-text-muted))]"
            style="margin: 0; line-height: 1.6;"
          >
            Posts will appear here once they're published.
          </p>
        </div>
      </div>
    )
  }
</PageLayout>
