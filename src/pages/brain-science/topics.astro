---
import BaseLayout from '../../layouts/BaseLayout.astro';
import BrainScienceLayout from '../../components/brain-science/BrainScienceLayout.astro';
import TimeSeriesChart from '../../components/brain-science/TimeSeriesChart.astro';
import BarChart from '../../components/brain-science/BarChart.astro';
import { getBrainSciencePosts } from '../../utils/brainScience/data';
import { getTagWeight, MASLOW_CATEGORIES, getTagCategory, getTagMetadata } from '../../data/tags';
import { generateDynamicInsights, calculateObjectiveMetrics } from '../../utils/insightGenerator';
import { BRAIN_SCIENCE_PAGES } from '../../data/brainScience';

// Get all published posts
const posts = await getBrainSciencePosts();

// Sort posts by date
const sortedPosts = posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Tag analysis
const tagFrequency = posts.reduce(
  (acc, post) => {
    post.data.tags?.forEach((tag) => {
      acc[tag] = (acc[tag] || 0) + 1;
    });
    return acc;
  },
  {} as Record<string, number>,
);

const topTags = Object.entries(tagFrequency)
  .sort(([, a], [, b]) => b - a)
  .map(([tag, count]) => ({
    tag,
    count,
    weight: getTagWeight(tag),
    category: getTagCategory(tag),
    metadata: getTagMetadata(tag),
  }));

// Maslow hierarchy analysis
const maslowAnalysis = MASLOW_CATEGORIES.map((category) => {
  const categoryPosts = posts.filter((post) =>
    post.data.tags?.some((tag) => category.tags.includes(tag)),
  ).length;
  return {
    ...category,
    postCount: categoryPosts,
    percentage: Math.round((categoryPosts / posts.length) * 100),
  };
}).filter((cat) => cat.postCount > 0);

// Tag co-occurrence analysis
const tagCooccurrence: Record<string, Record<string, number>> = {};
posts.forEach((post) => {
  const postTags = post.data.tags || [];
  postTags.forEach((tag1) => {
    if (!tagCooccurrence[tag1]) {
      tagCooccurrence[tag1] = {};
    }
    postTags.forEach((tag2) => {
      if (tag1 !== tag2) {
        tagCooccurrence[tag1][tag2] = (tagCooccurrence[tag1][tag2] || 0) + 1;
      }
    });
  });
});

// Find strongest tag relationships
const tagRelationships = Object.entries(tagCooccurrence)
  .flatMap(([tag1, relationships]) =>
    Object.entries(relationships).map(([tag2, count]) => ({
      tag1,
      tag2,
      count,
      strength: count / Math.min(tagFrequency[tag1], tagFrequency[tag2]),
    })),
  )
  .sort((a, b) => b.strength - a.strength)
  .slice(0, 20);

// Topic evolution over time (by quarters)
const quarters = [];
const currentYear = new Date().getFullYear();
const startYear = sortedPosts[sortedPosts.length - 1]?.data.pubDate.getFullYear() || currentYear;

for (let year = startYear; year <= currentYear; year++) {
  for (let quarter = 1; quarter <= 4; quarter++) {
    const quarterStart = new Date(year, (quarter - 1) * 3, 1);
    const quarterEnd = new Date(year, quarter * 3, 0);

    const quarterPosts = posts.filter(
      (post) => post.data.pubDate >= quarterStart && post.data.pubDate <= quarterEnd,
    );

    if (quarterPosts.length > 0) {
      const quarterTags = quarterPosts.reduce(
        (acc, post) => {
          post.data.tags?.forEach((tag) => {
            acc[tag] = (acc[tag] || 0) + 1;
          });
          return acc;
        },
        {} as Record<string, number>,
      );

      quarters.push({
        year,
        quarter,
        label: `Q${quarter} ${year}`,
        posts: quarterPosts.length,
        topTags: Object.entries(quarterTags)
          .sort(([, a], [, b]) => b - a)
          .slice(0, 5)
          .map(([tag, count]) => ({ tag, count, weight: getTagWeight(tag) })),
      });
    }
  }
}

// Personal insights about topics
const topicInsights = [
  {
    insight: 'Your core interests are deeply personal',
    evidence: `${topTags[0]?.count || 0} writings about "${topTags[0]?.tag || 'your top topic'}"`,
    impact: 'High',
    reflection: 'What makes this topic so meaningful to you?',
  },
  {
    insight: 'You explore diverse life areas',
    evidence: `${maslowAnalysis.length} different life areas represented`,
    impact: 'High',
    reflection: 'How do these different areas connect in your life?',
  },
  {
    insight: 'Your interests have strong connections',
    evidence: `${tagRelationships.length} strong topic relationships`,
    impact: 'Medium',
    reflection: 'What patterns do you see in how your interests relate?',
  },
  {
    insight: 'You focus on what matters most',
    evidence: `${Math.round((topTags.slice(0, 5).reduce((sum, tag) => sum + tag.count, 0) / posts.length) * 100)}% of writings in top 5 topics`,
    impact: 'High',
    reflection: 'Why do these topics consistently draw your attention?',
  },
];

// Topic clusters (grouping related topics)
const topicClusters = [
  {
    name: 'Personal Growth',
    topics: topTags.filter((tag) =>
      [
        'personal-growth',
        'transformation',
        'healing',
        'self-improvement',
        'learning',
        'consciousness',
        'mindfulness',
      ].includes(tag.tag),
    ),
    color: 'text-green-500',
    icon: 'üå±',
  },
  {
    name: 'Technical & Creative',
    topics: topTags.filter((tag) =>
      ['programming', 'technology', 'design', 'art', 'creativity', 'code', 'development'].includes(
        tag.tag,
      ),
    ),
    color: 'text-blue-500',
    icon: 'üíª',
  },
  {
    name: 'Life & Relationships',
    topics: topTags.filter((tag) =>
      ['parenting', 'family', 'relationships', 'love', 'life', 'daily-life', 'parenting'].includes(
        tag.tag,
      ),
    ),
    color: 'text-purple-500',
    icon: 'üíú',
  },
  {
    name: 'Philosophy & Reflection',
    topics: topTags.filter((tag) =>
      [
        'philosophy',
        'reflection',
        'thinking',
        'thoughts',
        'ideas',
        'metaspace',
        'consciousness',
      ].includes(tag.tag),
    ),
    color: 'text-yellow-500',
    icon: 'ü§î',
  },
].filter((cluster) => cluster.topics.length > 0);

// Calculate objective metrics
const objectiveMetrics = calculateObjectiveMetrics(posts);

// Generate dynamic insights
const insightData = {
  totalPosts: posts.length,
  totalWords: posts.reduce((sum, post) => sum + (post.body || '').split(/\s+/).length, 0),
  avgWordsPerPost: Math.round(
    posts.reduce((sum, post) => sum + (post.body || '').split(/\s+/).length, 0) / posts.length,
  ),
  topTags: topTags.slice(0, 5).map(({ tag, count }) => ({ tag, count })),
  emotionalPosts: 0, // Not calculated for topics
  growthPosts: 0, // Not calculated for topics
  complexityTrend: 'stable' as const, // Not calculated for topics
  productivityTrend: 'stable' as const, // Not calculated for topics
  knowledgeAreas: maslowAnalysis.map((area) => ({
    title: area.title,
    postCount: area.postCount,
    trend: 'stable' as const,
  })),
  writingStreaks: [],
  drySpells: [],
  // Add objective metrics
  ...objectiveMetrics,
};

const { insights, summary } = generateDynamicInsights(insightData, 'topics');

// Prepare time series for top 5 topics over quarters
const top5Tags = topTags.slice(0, 5);
const topicTimeSeriesData = quarters.map((quarter) => {
  const quarterLabel = quarter.label;
  const data: Record<string, number> = {};

  top5Tags.forEach((tag) => {
    const tagInQuarter = quarter.topTags.find((t) => t.tag === tag.tag);
    data[tag.tag] = tagInQuarter?.count || 0;
  });

  return {
    label: quarterLabel,
    ...data,
  };
});

// Calculate topic growth rates (comparing early vs recent periods)
const earlyQuarters = quarters.slice(0, Math.floor(quarters.length / 3));
const recentQuarters = quarters.slice(-Math.floor(quarters.length / 3));

const earlyTagCounts: Record<string, number> = {};
earlyQuarters.forEach((quarter) => {
  quarter.topTags.forEach(({ tag, count }) => {
    earlyTagCounts[tag] = (earlyTagCounts[tag] || 0) + count;
  });
});

const recentTagCounts: Record<string, number> = {};
recentQuarters.forEach((quarter) => {
  quarter.topTags.forEach(({ tag, count }) => {
    recentTagCounts[tag] = (recentTagCounts[tag] || 0) + count;
  });
});

const growingTopics = Object.keys({ ...earlyTagCounts, ...recentTagCounts })
  .map((tag) => {
    const earlyCount = earlyTagCounts[tag] || 0;
    const recentCount = recentTagCounts[tag] || 0;
    const growthRate =
      earlyCount > 0 ? ((recentCount - earlyCount) / earlyCount) * 100 : recentCount > 0 ? 100 : 0;
    return {
      tag,
      earlyCount,
      recentCount,
      growthRate,
    };
  })
  .filter((t) => t.growthRate > 0)
  .sort((a, b) => b.growthRate - a.growthRate);

// Prepare bar chart for topic growth rates
const topicGrowthChart = {
  labels: growingTopics.slice(0, 10).map((t) => t.tag),
  datasets: [
    {
      label: 'Growth Rate (%)',
      data: growingTopics.slice(0, 10).map((t) => Math.round(t.growthRate)),
      backgroundColor: 'rgba(34, 197, 94, 0.6)',
      borderColor: 'rgb(34, 197, 94)',
    },
  ],
};

// Get page info
const pageInfo = BRAIN_SCIENCE_PAGES.find((p) => p.id === 'topics');
---

<BaseLayout
  title="Topic Analysis Analytics - Brain Science"
  description="Quantitative analysis of writing themes, topic relationships, and interest patterns. Data-driven insights into content focus and thematic evolution."
  path="/brain-science/topics"
  structuredDataType="website"
>
  <BrainScienceLayout
    currentPage="/brain-science/topics"
    title={pageInfo?.title || 'Core Themes Analysis'}
    description="Quantitative analysis of writing themes, topic relationships, and interest patterns. Data-driven insights into content focus and thematic evolution over time."
  >
    {/* Topic Overview Metrics */}
    <div
      class="mb-8 grid grid-cols-2 gap-4 md:mb-10 md:grid-cols-2 md:gap-6 lg:mb-12 lg:grid-cols-4"
    >
      <div
        class="rounded-lg border border-[rgb(var(--color-border))] bg-[rgb(var(--color-bg-secondary))] p-4 md:p-6"
      >
        <div
          class="mb-1 text-xl font-bold text-[rgb(var(--color-text))] md:mb-2 md:text-2xl"
          title="Total number of unique topics you've written about"
        >
          {Object.keys(tagFrequency).length}
        </div>
        <div class="text-xs text-[rgb(var(--color-text-muted))] md:text-sm">Unique Topics</div>
        <div class="mt-1 text-xs text-blue-500">üéØ Areas of Interest</div>
      </div>
      <div
        class="rounded-lg border border-[rgb(var(--color-border))] bg-[rgb(var(--color-bg-secondary))] p-4 md:p-6"
      >
        <div
          class="mb-1 text-xl font-bold text-[rgb(var(--color-text))] md:mb-2 md:text-2xl"
          title="Number of life areas you explore in your writing"
        >
          {maslowAnalysis.length}
        </div>
        <div class="text-xs text-[rgb(var(--color-text-muted))] md:text-sm">Life Areas</div>
        <div class="mt-1 text-xs text-green-500">üåç Life Dimensions</div>
      </div>
      <div
        class="rounded-lg border border-[rgb(var(--color-border))] bg-[rgb(var(--color-bg-secondary))] p-4 md:p-6"
      >
        <div
          class="mb-1 text-xl font-bold text-[rgb(var(--color-text))] md:mb-2 md:text-2xl"
          title="Number of strong topic relationships identified"
        >
          {tagRelationships.length}
        </div>
        <div class="text-xs text-[rgb(var(--color-text-muted))] md:text-sm">Topic Connections</div>
        <div class="mt-1 text-xs text-purple-500">üîó Interest Networks</div>
      </div>
      <div
        class="rounded-lg border border-[rgb(var(--color-border))] bg-[rgb(var(--color-bg-secondary))] p-4 md:p-6"
      >
        <div
          class="mb-1 text-xl font-bold text-[rgb(var(--color-text))] md:mb-2 md:text-2xl"
          title="Percentage of writings in your top 5 topics"
        >
          {
            Math.round(
              (topTags.slice(0, 5).reduce((sum, tag) => sum + tag.count, 0) / posts.length) * 100,
            )
          }%
        </div>
        <div class="text-xs text-[rgb(var(--color-text-muted))] md:text-sm">Core Focus</div>
        <div class="mt-1 text-xs text-yellow-500">‚≠ê Primary Interests</div>
      </div>
    </div>

    {/* Topic Frequency Over Time */}
    {
      topicTimeSeriesData.length > 0 && top5Tags.length > 0 && (
        <div class="mb-8 md:mb-10 lg:mb-12">
          <h2 class="mb-4 text-lg font-semibold text-[rgb(var(--color-text))] md:mb-6 md:text-xl">
            üìà Top Topics Frequency Over Time
          </h2>
          <p class="mb-6 max-w-3xl text-sm text-[rgb(var(--color-text-muted))]">
            Quarterly frequency of top 5 topics. Formula: frequency(tag, quarter) = count(posts in
            quarter where tag ‚àà post.tags)
          </p>
          <TimeSeriesChart
            id="topic-frequency-timeline"
            labels={topicTimeSeriesData.map((q) => q.label)}
            datasets={top5Tags.map((tag, index) => ({
              label: tag.tag,
              data: topicTimeSeriesData.map((q) => (q as any)[tag.tag] || 0),
              borderColor: `hsl(${index * 60}, 70%, 50%)`,
              backgroundColor: `hsla(${index * 60}, 70%, 50%, 0.1)`,
            }))}
            title="Top 5 Topics Frequency Per Quarter"
            yAxisLabel="Post Count"
          />
        </div>
      )
    }

    {/* Topic Growth Rates */}
    {
      topicGrowthChart.labels.length > 0 && (
        <div class="mb-8 md:mb-10 lg:mb-12">
          <h2 class="mb-4 text-lg font-semibold text-[rgb(var(--color-text))] md:mb-6 md:text-xl">
            üìä Topic Growth Rates
          </h2>
          <p class="mb-6 max-w-3xl text-sm text-[rgb(var(--color-text-muted))]">
            Topics with highest growth rates. Formula: growth_rate = ((recent_count - early_count) /
            early_count) √ó 100
          </p>
          <BarChart
            id="topic-growth-chart"
            labels={topicGrowthChart.labels}
            datasets={topicGrowthChart.datasets}
            title="Top 10 Growing Topics"
            yAxisLabel="Growth Rate (%)"
          />
        </div>
      )
    }

    {/* Statistical Analysis */}
    <div class="mb-6 md:mb-8">
      <h3 class="mb-4 text-base font-semibold text-[rgb(var(--color-text))] md:mb-6 md:text-lg">
        üìä Topic Distribution Analysis
      </h3>
      <div class="grid grid-cols-1 gap-4 md:grid-cols-2 md:gap-6">
        {
          topicInsights.map((insight, index) => (
            <div class="rounded-lg border border-[rgb(var(--color-border))] bg-[rgb(var(--color-bg-secondary))] p-4">
              <div class="mb-3 flex items-center gap-3">
                <div class="text-base font-bold text-[rgb(var(--color-accent))] md:text-lg">
                  #{index + 1}
                </div>
                <span
                  class={`rounded px-2 py-1 text-xs ${
                    insight.impact === 'High'
                      ? 'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400'
                      : insight.impact === 'Medium'
                        ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400'
                        : 'bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400'
                  }`}
                >
                  {insight.impact} Significance
                </span>
              </div>
              <div class="mb-2 text-sm font-medium text-[rgb(var(--color-text))]">
                {insight.insight}
              </div>
              <div class="mb-3 text-xs text-[rgb(var(--color-text-muted))]">{insight.evidence}</div>
              <div class="text-xs text-[rgb(var(--color-text-muted))]">
                Statistical observation: {insight.evidence}
              </div>
            </div>
          ))
        }
      </div>
    </div>

    {/* Core Topics */}
    <div class="mb-6 md:mb-8 lg:mb-10">
      <h3 class="mb-4 text-base font-semibold text-[rgb(var(--color-text))] md:mb-6 md:text-lg">
        üìä Most Frequent Topics
      </h3>
      <p class="mb-4 text-xs text-[rgb(var(--color-text-muted))]">
        Topics ranked by frequency. Formula: frequency(tag) = count(posts where tag ‚àà post.tags) /
        total_posts
      </p>
      <div class="space-y-4">
        {
          topTags.slice(0, 10).map((tag, index) => (
            <div class="flex items-center justify-between rounded-lg bg-[rgb(var(--color-bg))] p-4">
              <div class="flex items-center gap-4">
                <div
                  class={`text-lg font-bold ${
                    index === 0
                      ? 'text-yellow-500'
                      : index === 1
                        ? 'text-gray-400'
                        : index === 2
                          ? 'text-amber-600'
                          : 'text-[rgb(var(--color-accent))]'
                  }`}
                >
                  {index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `#${index + 1}`}
                </div>
                <div>
                  <div class="text-sm font-medium text-[rgb(var(--color-text))]">{tag.tag}</div>
                  <div class="text-xs text-[rgb(var(--color-text-muted))]">
                    {tag.category?.title || 'Uncategorized'} ‚Ä¢ Weight: {tag.weight}
                  </div>
                </div>
              </div>
              <div class="text-right">
                <div
                  class="text-sm font-medium text-[rgb(var(--color-text))]"
                  title={`${tag.count} writings tagged with "${tag.tag}"`}
                >
                  {tag.count}
                </div>
                <div class="text-xs text-[rgb(var(--color-text-muted))]">
                  {Math.round((tag.count / posts.length) * 100)}% of writings
                </div>
              </div>
            </div>
          ))
        }
      </div>
    </div>

    {/* Topic Clusters */}
    <div class="mb-6 md:mb-8 lg:mb-10">
      <h3 class="mb-4 text-base font-semibold text-[rgb(var(--color-text))] md:mb-6 md:text-lg">
        üìä Topic Clusters
      </h3>
      <p class="mb-4 text-xs text-[rgb(var(--color-text-muted))]">
        Grouped topics by semantic similarity. Clusters determined by tag co-occurrence patterns.
      </p>
      <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
        {
          topicClusters.map((cluster) => (
            <div class="rounded-lg bg-[rgb(var(--color-bg))] p-4">
              <div class="mb-4 flex items-center gap-3">
                <span class="text-2xl">{cluster.icon}</span>
                <div>
                  <div class="text-lg font-semibold text-[rgb(var(--color-text))]">
                    {cluster.name}
                  </div>
                  <div class="text-sm text-[rgb(var(--color-text-muted))]">
                    {cluster.topics.length} topics ‚Ä¢{' '}
                    {cluster.topics.reduce((sum, tag) => sum + tag.count, 0)} writings
                  </div>
                </div>
              </div>
              <div class="space-y-2">
                {cluster.topics.map((tag) => (
                  <div class="flex items-center justify-between">
                    <span class="text-sm text-[rgb(var(--color-text))]">{tag.tag}</span>
                    <div class="flex items-center gap-2">
                      <div class="h-2 w-16 rounded-full bg-[rgb(var(--color-border))]">
                        <div
                          class={`h-2 rounded-full ${cluster.color.replace('text-', 'bg-')}`}
                          style={`width: ${(tag.count / Math.max(...cluster.topics.map((t) => t.count))) * 100}%`}
                        />
                      </div>
                      <span class="w-8 text-right text-xs text-[rgb(var(--color-text-muted))]">
                        {tag.count}
                      </span>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          ))
        }
      </div>
    </div>

    {/* Life Areas Focus */}
    <div class="mb-6 md:mb-8 lg:mb-10">
      <h3 class="mb-4 text-base font-semibold text-[rgb(var(--color-text))] md:mb-6 md:text-lg">
        üìä Maslow Hierarchy Distribution
      </h3>
      <p class="mb-4 text-xs text-[rgb(var(--color-text-muted))]">
        Content distribution across Maslow's hierarchy categories. Formula: category_percentage =
        (posts_in_category / total_posts) √ó 100
      </p>
      <div class="space-y-4">
        {
          maslowAnalysis.map((category) => (
            <div class="flex items-center justify-between rounded-lg bg-[rgb(var(--color-bg))] p-4">
              <div class="flex items-center gap-4">
                <span class="text-2xl">{category.icon}</span>
                <div>
                  <div class="text-sm font-medium text-[rgb(var(--color-text))]">
                    {category.title}
                  </div>
                  <div class="text-xs text-[rgb(var(--color-text-muted))]">
                    {category.description}
                  </div>
                </div>
              </div>
              <div class="text-right">
                <div
                  class="text-sm font-medium text-[rgb(var(--color-text))]"
                  title={`${category.postCount} writings in ${category.title} category`}
                >
                  {category.postCount}
                </div>
                <div class="text-xs text-[rgb(var(--color-text-muted))]">
                  {category.percentage}% of writings
                </div>
              </div>
            </div>
          ))
        }
      </div>
    </div>

    {/* Strongest Topic Relationships */}
    <div class="mb-6 md:mb-8 lg:mb-10">
      <h3 class="mb-4 text-base font-semibold text-[rgb(var(--color-text))] md:mb-6 md:text-lg">
        üîó Topic Co-occurrence Analysis
      </h3>
      <p class="mb-4 text-xs text-[rgb(var(--color-text-muted))]">
        Tag pairs that frequently appear together. Strength formula: strength = co_occurrence_count
        / min(frequency(tag1), frequency(tag2))
      </p>
      <div class="space-y-4">
        {
          tagRelationships.slice(0, 10).map((relationship, index) => (
            <div class="flex items-center justify-between rounded-lg bg-[rgb(var(--color-bg))] p-4">
              <div class="flex items-center gap-4">
                <div class="text-lg font-bold text-[rgb(var(--color-accent))]">#{index + 1}</div>
                <div>
                  <div class="text-sm font-medium text-[rgb(var(--color-text))]">
                    {relationship.tag1} ‚Üî {relationship.tag2}
                  </div>
                  <div class="text-xs text-[rgb(var(--color-text-muted))]">
                    Strength: {Math.round(relationship.strength * 100)}%
                  </div>
                </div>
              </div>
              <div class="text-right">
                <div
                  class="text-sm font-medium text-[rgb(var(--color-text))]"
                  title={`${relationship.count} writings contain both "${relationship.tag1}" and "${relationship.tag2}"`}
                >
                  {relationship.count}
                </div>
                <div class="text-xs text-[rgb(var(--color-text-muted))]">co-occurrences</div>
              </div>
            </div>
          ))
        }
      </div>
    </div>

    {/* Core Themes Formulas */}
    <div class="mb-6 md:mb-8 lg:mb-10">
      <h3
        class="mb-4 flex items-center gap-3 text-lg font-semibold text-[rgb(var(--color-text))] md:mb-6 md:text-xl"
      >
        <span class="text-2xl text-[rgb(var(--color-accent))]">üìä</span>
        Core Themes Formulas
      </h3>
      <div class="space-y-6 md:space-y-8">
        <div class="grid grid-cols-1 gap-6 md:gap-8 lg:grid-cols-2">
          <div>
            <h4
              class="mb-4 flex items-center gap-2 text-lg font-semibold text-[rgb(var(--color-text))]"
            >
              <span class="text-blue-500">üè∑Ô∏è</span>
              Topic Analysis
            </h4>
            <div class="space-y-3 text-[rgb(var(--color-text-muted))]">
              <p>
                <strong class="text-[rgb(var(--color-text))]">Topic Frequency:</strong> Posts per tag
                / Total posts
              </p>
              <p>
                <strong class="text-[rgb(var(--color-text))]">Top Topic Concentration:</strong>
                <code class="font-mono text-xs md:text-sm"
                  >Most frequent tag / Total posts √ó 100</code
                >
              </p>
              <p>
                <strong class="text-[rgb(var(--color-text))]">Topic Diversity:</strong> Number of unique
                tags used
              </p>
              <p>
                <strong class="text-[rgb(var(--color-text))]">Topic Balance:</strong>
                <code class="font-mono text-xs md:text-sm">Stable areas / Total areas √ó 100</code>
              </p>
            </div>
          </div>
          <div>
            <h4
              class="mb-4 flex items-center gap-2 text-lg font-semibold text-[rgb(var(--color-text))]"
            >
              <span class="text-green-500">üìà</span>
              Topic Trends
            </h4>
            <div class="space-y-3 text-[rgb(var(--color-text-muted))]">
              <p>
                <strong class="text-[rgb(var(--color-text))]">Growth Areas:</strong> Topics with increasing
                post frequency
              </p>
              <p>
                <strong class="text-[rgb(var(--color-text))]">Declining Areas:</strong> Topics with decreasing
                post frequency
              </p>
              <p>
                <strong class="text-[rgb(var(--color-text))]">Stable Areas:</strong> Topics with consistent
                post frequency
              </p>
              <p>
                <strong class="text-[rgb(var(--color-text))]">Trend Distribution:</strong> Growing/Declining/Stable
                topic counts
              </p>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 gap-6 md:gap-8 lg:grid-cols-2">
          <div>
            <h4
              class="mb-4 flex items-center gap-2 text-lg font-semibold text-[rgb(var(--color-text))]"
            >
              <span class="text-purple-500">üîó</span>
              Topic Relationships
            </h4>
            <div class="space-y-3 text-[rgb(var(--color-text-muted))]">
              <p>
                <strong class="text-[rgb(var(--color-text))]">Co-occurrence Strength:</strong> Shared
                posts / Total posts with either tag
              </p>
              <p>
                <strong class="text-[rgb(var(--color-text))]">Relationship Percentage:</strong>
                <code class="font-mono text-xs md:text-sm"
                  >Co-occurrence count / Total posts √ó 100</code
                >
              </p>
              <p>
                <strong class="text-[rgb(var(--color-text))]">Topic Clusters:</strong> Groups of frequently
                co-occurring tags
              </p>
              <p>
                <strong class="text-[rgb(var(--color-text))]">Cross-pollination:</strong> Tags that appear
                together across different posts
              </p>
            </div>
          </div>
          <div>
            <h4
              class="mb-4 flex items-center gap-2 text-lg font-semibold text-[rgb(var(--color-text))]"
            >
              <span class="text-orange-500">üéØ</span>
              Life Areas Focus
            </h4>
            <div class="space-y-3 text-[rgb(var(--color-text-muted))]">
              <p>
                <strong class="text-[rgb(var(--color-text))]">Maslow Distribution:</strong>
                <code class="font-mono text-xs md:text-sm"
                  >Posts per life area / Total posts √ó 100</code
                >
              </p>
              <p>
                <strong class="text-[rgb(var(--color-text))]">Area Concentration:</strong> Most focused
                life area percentage
              </p>
              <p>
                <strong class="text-[rgb(var(--color-text))]">Balance Score:</strong> Evenness of distribution
                across life areas
              </p>
              <p>
                <strong class="text-[rgb(var(--color-text))]">Growth Trajectory:</strong> Life area focus
                trends over time
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    {/* Analysis Conclusion */}
    <div
      class="rounded-lg border border-[rgb(var(--color-border))] bg-[rgb(var(--color-bg-secondary))] p-4 md:p-6"
    >
      <h3 class="mb-4 text-base font-semibold text-[rgb(var(--color-text))] md:mb-6 md:text-lg">
        üè∑Ô∏è Core Themes Summary
      </h3>
      <div class="space-y-4">
        {/* Dynamic Insights */}
        <div class="space-y-2">
          {
            insights.map((insight) => (
              <div class={`flex items-center gap-2 ${insight.color}`}>
                <span class="text-sm">
                  {insight.type === 'positive'
                    ? '‚úÖ'
                    : insight.type === 'negative'
                      ? '‚ùå'
                      : insight.type === 'warning'
                        ? '‚ö†Ô∏è'
                        : '‚ÑπÔ∏è'}
                </span>
                <span class="text-sm" set:html={insight.text} />
              </div>
            ))
          }
        </div>

        {/* Summary */}
        <div class="pt-4">
          <p class="text-sm text-[rgb(var(--color-text-muted))]" set:html={summary} />
        </div>
      </div>
    </div>
  </BrainScienceLayout>
</BaseLayout>
